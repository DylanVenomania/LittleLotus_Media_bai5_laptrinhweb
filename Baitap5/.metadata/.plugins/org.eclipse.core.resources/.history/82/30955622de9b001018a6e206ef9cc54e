package com.littlelotus.media.controller;

import com.littlelotus.media.entity.Post;
import com.littlelotus.media.entity.User;
import com.littlelotus.media.service.PostService;
import jakarta.servlet.http.HttpSession;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

import java.util.List;

@Controller
public class HomeController {

    private final PostService postService;

    public HomeController(PostService postService) 
    {
        this.postService = postService;
    }

    /**
     * Trang chủ - hiển thị feed (danh sách post + comment)
     * - Lấy user từ session (AuthController đã lưu "currentUser")
     * - Đưa cả "currentUser" và "sessionUser" vào model để tương thích templates cũ
     */
    @GetMapping("/")
    public String home(Model model, HttpSession session) {
        // Lấy user từ session (AuthController lưu là "currentUser")
        User currentUser = (User) session.getAttribute("currentUser");

        // Đặt cả 2 tên attribute để template cũ không bị lỗi (nếu dùng sessionUser)
        model.addAttribute("currentUser", currentUser);
        model.addAttribute("sessionUser", currentUser);

        // Load tất cả post (Post entity đã chứa comments)
        List<Post> posts = postService.getAllPosts();
        model.addAttribute("posts", posts);

        return "index"; // templates/index.html
    }
}
